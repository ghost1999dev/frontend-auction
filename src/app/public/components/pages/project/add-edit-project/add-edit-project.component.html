<div class="grid p-4">
    <div class="col-12">
      <h2>{{ projectId ? (isRepublishing ? 'Republish Project - ' : 'Edit Project - ') : 'Add New Project' }} {{projectId ? project.project_name: ''}} </h2>
      <p-toast></p-toast>
      
      <div class="grid">
        <!-- Left Column -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="project_name">Project Name*</label>
            <input type="text" pInputText id="project_name" [(ngModel)]="project.project_name" required 
                   [ngClass]="{'ng-invalid ng-dirty': submitted && !project.project_name}"/>
            <small class="p-error" *ngIf="submitted && !project.project_name">Project name is required.</small>
          </div>
          
          <div class="field">
            <label for="description">Short Description</label>
            <textarea id="description" pInputTextarea [(ngModel)]="project.description" 
                      rows="5" class="w-full"></textarea>
            <small class="p-error" *ngIf="submitted && !project.description">Short Description is required.</small>
          </div>
        </div>
        
        <!-- Right Column -->
        <div class="col-12 md:col-6">

          <!-- Campo Budget -->
          <div class="field">
            <label for="budget">Budget</label>
            <input [disabled]="shouldDisableFields()" type="number" min="0" 
                  (keypress)="keyPressNumbersWithDecimal($event)" pInputText id="budget" 
                  [(ngModel)]="project.budget" class="w-full"/>
            <small class="p-error" *ngIf="submitted && !project.budget">Budget is required.</small>
          </div>

          <!-- Campo Days Available -->
          <div class="field">
            <label for="days_available">Days Available</label>
            <input [disabled]="shouldDisableFields()" type="number" min="0" pInputText 
                  id="days_available" [(ngModel)]="project.days_available" 
                  class="w-full width-txt" appNumbersOnly />
            <small class="p-error" *ngIf="submitted && !project.days_available">Days Available is required.</small>
            <p class="mt-1" style="color: red; font-size: 13px;">
                The Project {{project.project_name}} is available {{project.days_available}} days, after the Project is approved.            
            </p>
          </div>

          <!-- Add this select field -->
          <div class="field">
            <label for="category">Category*</label>
            <p-dropdown [options]="categories" [(ngModel)]="project.category_id" optionLabel="name" 
                        optionValue="id" id="category" [showClear]="true" placeholder="Select a category"
                        [ngClass]="{'ng-invalid ng-dirty': submitted && !project.category_id}"
                        class="category-dropdown">
            </p-dropdown>
            <small class="p-error" *ngIf="submitted && !project.category_id">Category is required.</small>
        </div>
        </div>

        <!-- Full Description (Full width below) -->
        <div class="col-12">
          <div class="field">
            <label for="full_description">Full Description </label>
            <angular-editor [(ngModel)]="project.full_description" [placeholder]="'Enter text here...'" height="15rem" class="_angular-editor" name="description" id="description"></angular-editor>
            </div>
          </div>
        </div>
      
      <!-- Terms and Conditions Section -->
      <div class="col-12" *ngIf="!projectId || isRepublishing">
        <div class="field">
            <div class="flex align-items-center">
                <p-checkbox [(ngModel)]="termsAccepted" [binary]="true" inputId="terms"></p-checkbox>
                <label for="terms" class="ml-2 mt-2">
                    I accept the 
                    <a (click)="showTermsDialog()" class="text-primary cursor-pointer">Terms and Conditions</a>
                </label>
            </div>
            <small class="p-error" *ngIf="submitted && !termsAccepted && (!projectId || isRepublishing)">
                You must accept the terms and conditions
            </small>
        </div>
      </div>


      <div class="flex justify-content-end gap-2 mt-4">
        <button pButton pRipple label="Cancel" icon="pi pi-times" 
                class="p-button-text" (click)="cancel()" [disabled]="loading"></button>
        <button pButton pRipple label="Save" icon="pi pi-check" 
        class="p-button-text" (click)="saveProject()" 
        [disabled]="loading || (!termsAccepted && (isRepublishing || !projectId))">
            <i *ngIf="loading" class="pi pi-spinner pi-spin mr-2"></i>
        </button>
      </div>
    </div>
  </div>

<!-- Terms and Conditions Dialog -->

<p-dialog header="Terms and Conditions" [(visible)]="displayTermsDialog" [style]="{width: '80vw'}" [maximizable]="true" [modal]="true">
  <div class="pdf-container">
    <pdf-viewer [src]="termsPdfUrl"
                [render-text]="true"
                [original-size]="false"
                [show-all]="true"
                style="width: 100%; height: 70vh;"
                (error)="onPdfError($event)">
    </pdf-viewer>

    <!-- Mostrar mensaje si hay error al cargar PDF -->
    <div *ngIf="pdfLoadError" class="p-4 text-center">
      <p class="text-red-500">No se pudo cargar el PDF. Por favor intente más tarde.</p>
      <p>Alternativamente, puede <a [href]="termsPdfUrl" target="_blank" class="text-primary">ver los términos en una nueva pestaña</a>.</p>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button pButton pRipple label="Close" icon="pi pi-times" (click)="closeDialog()" class="p-button-text"></button>
    <button pButton pRipple label="Accept" icon="pi pi-check" (click)="acceptTerms()" [disabled]="pdfLoadError" class="p-button-text"></button>
  </ng-template>
</p-dialog>
